C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN .\output\oled.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE oled\oled.c LARGE BROWSE INCDIR(.\main;.\eeprom;.\oled;.\uart;.\74hc595;.\c
                    -d4052;.\isr;.\Key) DEBUG OBJECTEXTEND PRINT(.\list\oled.lst) OBJECT(.\output\oled.obj)

line level    source

   1          /***********************************************************************************************
   2          ¹¦ÄÜËµÃ÷£ºÒÑÖ§³Ö»­µã£¬»­Ïß£¬»­¾ØÐÎ£¬»­Ô²£¬»­´°¿Ú£¬»­BMP
   3          ÒÆÖ²£ºliaokeyre
   4          ************************************************************************************************/
   5          //½Ó¿Ú¶¨Òå²ÎÕÕoled.hÎÄ¼þ
   6          //ËÄÏßSPIÐèÒª½ÓÆß¸ùÏß£¬ÆäÖÐRES¿ÉÒÔ²»½Ó£»µ«ÊÇ²»½ÓÊ±ºò±ØÐëÀ­¸ß
   7          // GND,VCC,CS,RES,D/C,CLK,DIN
   8          //¹ØÓÚµçÑ¹ÎÊÌâ£»Èç¹û¿Í»§ÐèÒª³¤Ê±¼äÎÈ¶¨¹¤×÷£»½¨ÒéÈ«²¿²ÉÓÃ3.3VµçÔ´£»µçÆ½ÐÅºÅÒ²²ÉÓÃ3.3VµÄ
   9          //Èç¹û¿Í»§ÐèÒªÓÃ5VµçÔ´£¬ËäÈ»5V¿ÉÒÔÕý³£¹¤×÷£¬µ«Ê½¨ÒéÇ²»Òª³¤Ê±¼ä¹¤×÷£»ÕâÑù¿ÉÄÜ»á¼õÉÙÆÁµÄÊÙÃü£»ÔÚVCC¶Ë´®Ò»Ð¡µ
             -ç×è¿ÉÄÜ»áºÃÒ»Ð©¡£
  10          #include "oled.h"
  11          #include "oledfont.h" 
  12          #include "24c02.h"
  13          #include "cd4052.h"
  14          #define GUI_LCM_XMAX 128
  15          #define GUI_LCM_YMAX  32         
  16          //#include "delay.h"
  17          //OLEDµÄÏÔ´æ
  18          //´æ·Å¸ñÊ½ÈçÏÂ.
  19          //[0]0 1 2 3 ... 127    
  20          //[1]0 1 2 3 ... 127    
  21          //[2]0 1 2 3 ... 127    
  22          //[3]0 1 2 3 ... 127
  23          //--------------------------------------12832   
  24          //[4]0 1 2 3 ... 127    
  25          //[5]0 1 2 3 ... 127    
  26          //[6]0 1 2 3 ... 127    
  27          //[7]0 1 2 3 ... 127 
  28          u8 OLED_GRAM[128][4];//ÏÔ´æ
  29          u8 OLED_GRAM_TMP[128][4];
  30          
  31          /****************************************************************************
  32          ×Ö½ÚÂë¸ßµÍÎ»¾µÏñ²Ù×÷
  33          Ö÷ÒªÊÇÓÐÒ»¸ö×Ö¿âÈ¡Âë·½ÏòÊÇ·´µÄ
  34          ÖØÐÂ×ö×Ö¿âÓÖÂé·³¡£¡£¡£¡£
  35          ****************************************************************************/   
  36          u8 ByteMirro(u8 dat)
  37          {
  38   1       dat = (dat & 0xf0) >> 4 | (dat & 0x0f)  << 4;//ÒÔ4Î»Îªµ¥Î»½øÐÐ½»»»    abcd  1234
  39   1       dat = (dat & 0xcc) >> 2 | (dat & 0x33)  << 2;//ÒÔ2Î»Îªµ¥Î»½øÐÐ½»»»    cdab  3412
  40   1       dat = (dat & 0xaa) >> 1 | (dat & 0x55)  << 1;//ÒÔ1Î»Îªµ¥Î»½øÐÐ½»»»   dcba  4321
  41   1       return dat;
  42   1      }
  43                             
  44          void delay_ms(unsigned int ms)
  45          {                         
  46   1              unsigned int a;
  47   1              while(ms)
  48   1              {
  49   2                      a=1800;
  50   2                      while(a--);
  51   2                      ms--;
  52   2              }
  53   1      //      return;
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 2   

  54   1      }
  55          #if OLED_MODE==1
              //ÏòSSD1106Ð´ÈëÒ»¸ö×Ö½Ú¡£
              //dat:ÒªÐ´ÈëµÄÊý¾Ý/ÃüÁî
              //cmd:Êý¾Ý/ÃüÁî±êÖ¾ 0,±íÊ¾ÃüÁî;1,±íÊ¾Êý¾Ý;
              void OLED_WR_Byte(u8 dat,u8 cmd)
              {
                      DATAOUT(dat);       
                      if(cmd)
                        OLED_DC_Set();
                      else 
                        OLED_DC_Clr();                   
                      OLED_CS_Clr();
                      OLED_WR_Clr();   
                      OLED_WR_Set();
                      OLED_CS_Set();    
                      OLED_DC_Set();   
              }                   
              #else
  73          //ÏòSSD1306Ð´ÈëÒ»¸ö×Ö½Ú¡£
  74          //dat:ÒªÐ´ÈëµÄÊý¾Ý/ÃüÁî
  75          //cmd:Êý¾Ý/ÃüÁî±êÖ¾ 0,±íÊ¾ÃüÁî;1,±íÊ¾Êý¾Ý;
  76          void OLED_WR_Byte(u8 dat,u8 cmd)
  77          {       
  78   1              u8 i;                     
  79   1              if(cmd)
  80   1                OLED_DC_Set();
  81   1              else 
  82   1                OLED_DC_Clr();                  
  83   1              OLED_CS_Clr();
  84   1              for(i=0;i<8;i++)
  85   1              {                         
  86   2                      OLED_SCLK_Clr();
  87   2                      if(dat&0x80)
  88   2                      {
  89   3                        OLED_SDIN_Set();
  90   3                      }
  91   2              else
  92   2                  OLED_SDIN_Clr();
  93   2                  OLED_SCLK_Set();
  94   2                      dat<<=1;   
  95   2              }                                                 
  96   1              OLED_CS_Set();
  97   1              OLED_DC_Set();            
  98   1      } 
  99          #endif
 100          
 101          void OLED_Set_Pos(unsigned char x, unsigned char y) 
 102          { 
 103   1              OLED_WR_Byte(0xb0+y,OLED_CMD);
 104   1              OLED_WR_Byte(((x&0xf0)>>4)|0x10,OLED_CMD);
 105   1              OLED_WR_Byte((x&0x0f)|0x01,OLED_CMD); 
 106   1      } 
 107          /*        
 108          //¿ªÆôOLEDÏÔÊ¾    
 109          void OLED_Display_On(void)
 110          {
 111                  OLED_WR_Byte(0X8D,OLED_CMD);  //SET DCDCÃüÁî
 112                  OLED_WR_Byte(0X14,OLED_CMD);  //DCDC ON
 113                  OLED_WR_Byte(0XAF,OLED_CMD);  //DISPLAY ON
 114          }
 115          //¹Ø±ÕOLEDÏÔÊ¾     
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 3   

 116          void OLED_Display_Off(void)
 117          {
 118                  OLED_WR_Byte(0X8D,OLED_CMD);  //SET DCDCÃüÁî
 119                  OLED_WR_Byte(0X10,OLED_CMD);  //DCDC OFF
 120                  OLED_WR_Byte(0XAE,OLED_CMD);  //DISPLAY OFF
 121          }
 122          */
 123          void OLED_Refresh_Gram(void)
 124          {
 125   1              u8 i,n;             
 126   1              for(i=0;i<4;i++)  
 127   1              {  
 128   2                      OLED_WR_Byte (0xb4+i,OLED_CMD);    //ÉèÖÃÒ³µØÖ·£¨0~7£©b4-->b7
 129   2                      OLED_WR_Byte (0x04,OLED_CMD);      //ÉèÖÃÏÔÊ¾Î»ÖÃ¡ªÁÐµÍµØÖ·
 130   2                      OLED_WR_Byte (0x10,OLED_CMD);      //ÉèÖÃÏÔÊ¾Î»ÖÃ¡ªÁÐ¸ßµØÖ·   
 131   2                      for(n=0;n<128;n++)OLED_WR_Byte(OLED_GRAM[n][i],OLED_DATA); 
 132   2              }   
 133   1      }
 134                                                   
 135          //ÇåÆÁº¯Êý,ÇåÍêÆÁ,Õû¸öÆÁÄ»ÊÇºÚÉ«µÄ!ºÍÃ»µãÁÁÒ»Ñù!!!      
 136          void OLED_Clear(void)  
 137          {  
 138   1              u8 i,n;  
 139   1              for(i=0;i<4;i++)for(n=0;n<128;n++)OLED_GRAM[n][i]=0X00;  
 140   1      //      OLED_Refresh_Gram();//¸üÐÂÏÔÊ¾
 141   1      }  
 142          //»­µã 
 143          //x:0~127
 144          //y:0~63
 145          //t:1 Ìî³ä 0,Çå¿Õ                                  
 146          void OLED_DrawPoint(u8 x,u8 y,u8 t)
 147          {
 148   1              u8 pos,bx,temp=0;
 149   1              if(x>127||y>63)return;//³¬³ö·¶Î§ÁË.
 150   1              pos=7-y/8;            //µÃµ½ËùÔÚÒ³
 151   1              bx=y%8;                           //µÃµ½µ±Ç°Ò³¾«È·Î»ÖÃ
 152   1              temp=1<<(7-bx);
 153   1              if(t)OLED_GRAM[x][pos]|=temp;
 154   1              else OLED_GRAM[x][pos]&=~temp;      
 155   1      }
 156          
 157          //////////////////////////////////
 158          //ÒÔx1,y1ÎªÆðµã£¬x2,y2ÎªÖÕµã»­Ïß//
 159          /////////(t=1»­µã£¬t=0Çåµã)///////
 160          //////////////////////////////////
 161          //»­Ïßº¯Êý
 162          void OLED_DrawLine(u8 x1,u8 y1,u8 x2,u8 y2,u8 t) //y=kx+b
 163          {
 164   1              s16 dy;
 165   1              s16 dx;
 166   1              s8 dirx,diry,move;
 167   1              dy=y2-y1; 
 168   1              dx=x2-x1; 
 169   1              if(dy<0)  
 170   1              {
 171   2                      dy=-dy;
 172   2                      diry=-1;
 173   2              }
 174   1              else 
 175   1              {
 176   2                      diry=1;
 177   2              }
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 4   

 178   1              if(dx<0)
 179   1              {
 180   2                      dx=-dx;
 181   2                      dirx=-1;
 182   2              }
 183   1              else
 184   1              {
 185   2                      dirx=1;
 186   2              }
 187   1      //      dy<<=1; 
 188   1      //      dx<<=1;
 189   1              OLED_DrawPoint(x1,y1,t);
 190   1              if(dx>dy)       //////////////////
 191   1              {
 192   2                      move=dy-(dx>>1); 
 193   2                      while(x1!=x2)
 194   2                      {
 195   3                              if(move>=0)
 196   3                              {
 197   4                                      y1+=diry; 
 198   4                                      move-=dx;
 199   4                              }
 200   3                              x1+=dirx;
 201   3                              move+=dy;  
 202   3                              OLED_DrawPoint(x1,y1,t);
 203   3                      }
 204   2              }
 205   1              else
 206   1              {
 207   2                      move=dx-(dy>>1);
 208   2                      while(y1!=y2)
 209   2                      {
 210   3                              if(move>=0)
 211   3                              {
 212   4                                      x1+=dirx;
 213   4                                      move-=dy;
 214   4                              }
 215   3                              y1+=diry;
 216   3                              move+=dx;
 217   3                              OLED_DrawPoint(x1,y1,t);
 218   3                      }
 219   2              }
 220   1      }
 221          
 222          /****************************************************************************
 223          * ¹¦ÄÜ£º»­Ë®Æ½Ïß¡£
 224          * Èë¿Ú²ÎÊý£ºx0      Ë®Æ½ÏßÆðµãËùÔÚÁÐµÄÎ»ÖÃ
 225          *           y0      Ë®Æ½ÏßÆðµãËùÔÚÐÐµÄÎ»ÖÃ
 226          *           x1      Ë®Æ½ÏßÖÕµãËùÔÚÁÐµÄÎ»ÖÃ
 227          *           t       ÏÔÊ¾ÑÕÉ«(¶ÔÓÚºÚ°×É«LCM£¬Îª0Ê±Ãð£¬Îª1Ê±ÏÔÊ¾)
 228          * ³ö¿Ú²ÎÊý£ºÎÞ
 229          * ËµÃ÷£º¶ÔÓÚµ¥É«¡¢4¼¶»Ò¶ÈµÄÒº¾§£¬¿ÉÍ¨¹ýÐÞ¸Ä´Ëº¯Êý×÷Í¼Ìá¸ßËÙ¶È£¬Èçµ¥É«LCM£¬¿ÉÒÔÒ»´Î¸ü
 230          *      ÐÂ8¸öµã£¬¶ø²»ÐèÒªÒ»¸öµãÒ»¸öµãµÄÐ´µ½LCMÖÐ¡£
 231          ****************************************************************************/
 232          void  OLED_Draw_HLine(u8 x0, u8 y0, u8 x1, u8 t)
 233          {
 234   1          u8  temp;
 235   1          if(x0>x1)               // ¶Ôx0¡¢x1´óÐ¡½øÐÐÅÅÁÐ£¬ÒÔ±ã»­Í¼
 236   1          {
 237   2              temp = x1;
 238   2              x1 = x0;
 239   2              x0 = temp;
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 5   

 240   2          }
 241   1          do
 242   1          {
 243   2              OLED_DrawPoint(x0, y0, t);   // ÖðµãÏÔÊ¾£¬Ãè³ö´¹Ö±Ïß
 244   2              x0++;
 245   2          }
 246   1          while(x1>=x0);
 247   1      }
 248          /****************************************************************************
 249          * ¹¦ÄÜ£º»­´¹Ö±Ïß¡£
 250          * Èë¿Ú²ÎÊý£ºx0      ´¹Ö±ÏßÆðµãËùÔÚÁÐµÄÎ»ÖÃ
 251          *           y0      ´¹Ö±ÏßÆðµãËùÔÚÐÐµÄÎ»ÖÃ
 252          *           y1      ´¹Ö±ÏßÖÕµãËùÔÚÐÐµÄÎ»ÖÃ
 253          *           t       ÏÔÊ¾ÑÕÉ«
 254          * ³ö¿Ú²ÎÊý£ºÎÞ
 255          * ËµÃ÷£º¶ÔÓÚµ¥É«¡¢4¼¶»Ò¶ÈµÄÒº¾§£¬¿ÉÍ¨¹ýÐÞ¸Ä´Ëº¯Êý×÷Í¼Ìá¸ßËÙ¶È£¬Èçµ¥É«LCM£¬¿ÉÒÔÒ»´Î¸ü
 256          *      ÐÂ8¸öµã£¬¶ø²»ÐèÒªÒ»¸öµãÒ»¸öµãµÄÐ´µ½LCMÖÐ¡£
 257          ****************************************************************************/
 258          void  OLED_Draw_RLine(u8 x0, u8 y0, u8 y1, u8 t)
 259          {
 260   1          u8  temp;
 261   1          if(y0>y1)       // ¶Ôy0¡¢y1´óÐ¡½øÐÐÅÅÁÐ£¬ÒÔ±ã»­Í¼
 262   1          {
 263   2              temp = y1;
 264   2              y1 = y0;
 265   2              y0 = temp;
 266   2          }
 267   1          do
 268   1          {
 269   2              OLED_DrawPoint(x0, y0, t);   // ÖðµãÏÔÊ¾£¬Ãè³ö´¹Ö±Ïß
 270   2              y0++;
 271   2          }
 272   1          while(y1>=y0);
 273   1      }
 274          /****************************************************************************
 275          * ¹¦ÄÜ£º»­¾ØÐÎ¡£
 276          * Èë¿Ú²ÎÊý£ºx0          ¾ØÐÎ×óÉÏ½ÇµÄx×ø±êÖµ
 277          *           y0          ¾ØÐÎ×óÉÏ½ÇµÄy×ø±êÖµ
 278          *           x1      ¾ØÐÎÓÒÏÂ½ÇµÄx×ø±êÖµ
 279          *           y1      ¾ØÐÎÓÒÏÂ½ÇµÄy×ø±êÖµ
 280          *           t       1»­µã£¬0Çåµã
 281          * ³ö¿Ú²ÎÊý£ºÎÞ
 282          * ËµÃ÷£º²Ù×÷Ê§°ÜÔ­ÒòÊÇÖ¸¶¨µØÖ·³¬³öÓÐÐ§·¶Î§¡£
 283          ****************************************************************************/
 284          void  OLED_DrawRectangle(u8 x1, u8 y1, u8 x2, u8 y2, u8 t)
 285          {  OLED_Draw_HLine(x1, y1, x2, t);
 286   1         OLED_Draw_HLine(x1, y2, x2, t);
 287   1         OLED_Draw_RLine(x1, y1, y2, t);
 288   1         OLED_Draw_RLine(x2, y1, y2, t);
 289   1      }
 290          /****************************************************************************
 291          * ¹¦ÄÜ£ºÌî³ä¾ØÐÎ¡£»­Ò»¸öÌî³äµÄ¾ØÐÎ£¬Ìî³äÉ«Óë±ß¿òÉ«Ò»Ñù¡£
 292          * Èë¿Ú²ÎÊý£ºx0          ¾ØÐÎ×óÉÏ½ÇµÄx×ø±êÖµ
 293          *           y0          ¾ØÐÎ×óÉÏ½ÇµÄy×ø±êÖµ
 294          *           x1      ¾ØÐÎÓÒÏÂ½ÇµÄx×ø±êÖµ
 295          *           y1      ¾ØÐÎÓÒÏÂ½ÇµÄy×ø±êÖµ
 296          *           t       Ìî³äÑÕÉ«
 297          * ³ö¿Ú²ÎÊý£ºÎÞ
 298          * ËµÃ÷£º²Ù×÷Ê§°ÜÔ­ÒòÊÇÖ¸¶¨µØÖ·³¬³öÓÐÐ§·¶Î§¡£
 299          ****************************************************************************/
 300          void  OLED_Draw_RectangleFill(u8 x0, u8 y0, u8 x1, u8 y1, u8 t)
 301          {  u8  i;
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 6   

 302   1      
 303   1         /* ÏÈÕÒ³ö¾ØÐÎ×óÉÏ½ÇÓëÓÒÏÂ½ÇµÄÁ½¸öµã£¬±£´æÔÚ(x0,y0)£¬(x1,y1) */
 304   1         if(x0>x1)                                            // Èôx0>x1£¬Ôòx0Óëx1½»»»
 305   1         {  i = x0;
 306   2            x0 = x1;
 307   2            x1 = i;
 308   2         }
 309   1         if(y0>y1)                                            // Èôy0>y1£¬Ôòy0Óëy1½»»»
 310   1         {  i = y0;
 311   2            y0 = y1;
 312   2            y1 = i;
 313   2         }
 314   1         
 315   1         /* ÅÐ¶ÏÊÇ·ñÖ»ÊÇÖ±Ïß */
 316   1         if(y0==y1) 
 317   1         {  OLED_Draw_HLine(x0, y0, x1, t);
 318   2            return;
 319   2         }
 320   1         if(x0==x1) 
 321   1         {  (x0, y0, y1, t);
 322   2            return;
 323   2         }
 324   1      
 325   1         while(y0<=y1)                                                
 326   1         {  OLED_Draw_HLine(x0, y0, x1, t);   // µ±Ç°»­Ë®Æ½Ïß
 327   2            y0++;                                                     // ÏÂÒ»ÐÐ
 328   2         }
 329   1      }
 330          /****************************************************************************
 331          * ¹¦ÄÜ£º»­Õý·½ÐÎ¡£
 332          * Èë¿Ú²ÎÊý£ºx0          Õý·½ÐÎ×óÉÏ½ÇµÄx×ø±êÖµ
 333          *           y0          Õý·½ÐÎ×óÉÏ½ÇµÄy×ø±êÖµ
 334          *           with    Õý·½ÐÎµÄ±ß³¤
 335          *           t       ÏÔÊ¾ÑÕÉ«
 336          * ³ö¿Ú²ÎÊý£ºÎÞ
 337          * ËµÃ÷£º²Ù×÷Ê§°ÜÔ­ÒòÊÇÖ¸¶¨µØÖ·³¬³öÓÐÐ§·¶Î§¡£
 338          ****************************************************************************/
 339          void  OLED_Draw_Square(u8 x0, u8 y0, u8  with, u8 t)
 340          { 
 341   1          if(with==0) return;
 342   1              if( (x0+with) > GUI_LCM_XMAX ) return;
 343   1              if( (y0+with) > GUI_LCM_YMAX ) return;
 344   1              OLED_DrawRectangle(x0, y0, x0+with, y0+with, t);
 345   1      }
 346          /****************************************************************************
 347          * ¹¦ÄÜ£º»­Õý·½ÐÎÌî³ä¡£
 348          * Èë¿Ú²ÎÊý£ºx0          Õý·½ÐÎ×óÉÏ½ÇµÄx×ø±êÖµ
 349          *           y0          Õý·½ÐÎ×óÉÏ½ÇµÄy×ø±êÖµ
 350          *           with    Õý·½ÐÎµÄ±ß³¤
 351          *           t       ÏÔÊ¾ÑÕÉ«
 352          * ³ö¿Ú²ÎÊý£ºÎÞ
 353          * ËµÃ÷£º²Ù×÷Ê§°ÜÔ­ÒòÊÇÖ¸¶¨µØÖ·³¬³öÓÐÐ§·¶Î§¡£
 354          ****************************************************************************/
 355          void  OLED_Draw_SquareFill(u8 x0, u8 y0, u8  with, u8 t)
 356          { 
 357   1          if(with==0) return;
 358   1              if( (x0+with) > GUI_LCM_XMAX ) return;
 359   1              if( (y0+with) > GUI_LCM_YMAX ) return;
 360   1              OLED_Draw_RectangleFill(x0, y0, x0+with, y0+with, t);
 361   1      }
 362          /****************************************************************************
 363          * ¹¦ÄÜ£º¶à¸öµãÖ®¼äµÄÁ¬ÐøÁ¬Ïß¡£´ÓµÚÒ»µãÁ¬µ½µÚ¶þµã£¬ÔÙÁ¬µ½µÚÈýµã...
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 7   

 364          * Èë¿Ú²ÎÊý£ºpoints  ¶à¸öµã×ø±êÊý¾ÝµÄÖ¸Õë£¬Êý¾ÝÅÅÁÐÎª(x0,y0)¡¢(x1,y1)¡¢(x2,y2)...
 365          *           no      µãÊýÄ¿£¬ÖÁÉÙÒª´óÓÚ1
 366          *           t   ÏÔÊ¾ÑÕÉ«
 367          * ³ö¿Ú²ÎÊý£ºÎÞ
 368          * ËµÃ÷£º²Ù×÷Ê§°ÜÔ­ÒòÊÇÖ¸¶¨µØÖ·³¬³öÓÐÐ§·¶Î§¡£
 369          ****************************************************************************/
 370          void  OLED_Draw_LineS(u8 const *points, u8 no, u8 t)
 371          {  u8  x0, y0;
 372   1         u8  x1, y1;
 373   1         u8  i;
 374   1      
 375   1         /* Èë¿Ú²ÎÊý¹ýÂË */
 376   1         if(0==no) return;
 377   1         if(1==no)                                            // µ¥µã
 378   1         {  x0 = *points++;
 379   2            y0 = *points;
 380   2            OLED_DrawPoint(x0, y0, t);
 381   2         }
 382   1         
 383   1         /* »­¶àÌõÏßÌõ */
 384   1         x0 = *points++;                                      // È¡³öµÚÒ»µã×ø±êÖµ£¬×÷ÎªÔ­Æðµã×ø±êÖµ
 385   1         y0 = *points++;
 386   1         for(i=1; i<no; i++)
 387   1         {  x1 = *points++;                           // È¡³öÏÂÒ»µã×ø±êÖµ
 388   2            y1 = *points++;
 389   2            OLED_DrawLine(x0, y0, x1, y1, t);
 390   2            x0 = x1;                                          // ¸üÐÂÔ­Æðµã×ø±ê
 391   2            y0 = y1;
 392   2         }
 393   1      }
 394          //////////////////////////////
 395          //ÒÔx,yÎªÔ²ÐÄ£¬ÒÔrÎª°ë¾¶»­Ô²//
 396          /////(t=1»­µã£¬t=0Çåµã)///////
 397          //////////////////////////////
 398          //»­Ô²º¯Êý
 399          void OLED_DrawCircle(u8 x,u8 y,u16 r,u8 t)
 400          {
 401   1              u8 xc=0;
 402   1              u8 yc;
 403   1              s8 p;
 404   1              yc=r;
 405   1              p=3-(r<<1);
 406   1              while(xc<=yc)  
 407   1              {                 
 408   2                      OLED_DrawPoint(x+xc,y+yc,t);
 409   2                      OLED_DrawPoint(x+xc,y-yc,t);
 410   2                      OLED_DrawPoint(x-xc,y+yc,t);
 411   2                      OLED_DrawPoint(x-xc,y-yc,t);
 412   2                      OLED_DrawPoint(x+yc,y+xc,t);
 413   2                      OLED_DrawPoint(x+yc,y-xc,t);
 414   2                      OLED_DrawPoint(x-yc,y+xc,t);
 415   2                      OLED_DrawPoint(x-yc,y-xc,t);
 416   2                      if(p<0)
 417   2                      p+=((xc++)<<2)+6;
 418   2                      else
 419   2                      p+=(((xc++)-(yc--))<<2)+10;
 420   2              }
 421   1      }
 422          
 423          /****************************************************************************
 424          * ¹¦ÄÜ£ºÏÔÊ¾´°¿Ú¡£¸ù¾ÝÌá¹©µÄ´°¿Ú²ÎÊý½øÐÐ»­´°¿Ú¡£
 425          * Èë¿Ú²ÎÊý£ºwin         ´°¿Ú¾ä±ú
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 8   

 426          * ³ö¿Ú²ÎÊý£º·µ»Ø0±íÊ¾²Ù×÷Ê§°Ü£¬·µ»Ø1±íÊ¾²Ù×÷³É¹¦
 427          ****************************************************************************/
 428          u8  OLED_Draw_WindowsDraw(WINDOWS *win)
 429          {  u8  *str;
 430   1         int8  bak, bak1, bak2;
 431   1         
 432   1         /* ²ÎÊý¹ýÂË£¬Èô´°¿ÚÆð³ö·¶Î§£¬Ôò·µ»Ø0 */
 433   1         if( ( (win->with)<20 ) || ( (win->hight)<20 ) ) return(0);           // ¿í¶È¡¢¸ß¶È¼ì²é£¬ÏÞÖÆ×îÐ¡´°¿Ú
 434   1         if( (win->x + win->with ) > GUI_LCM_XMAX ) return(0);                        // ´°¿Ú¿í¶ÈÊÇ·ñÒç³ö
 435   1         if( (win->y + win->hight ) > GUI_LCM_YMAX ) return(0);                       // ´°¿Ú¸ß¶ÈÊÇ·ñÒç³ö
 436   1          
 437   1         /* ¿ªÊ¼»­´°¿Ú */
 438   1         OLED_Draw_RectangleFill(win->x, win->y, win->x + win->with - 1, win->y + win->hight - 1, 0); //Çå³öÒ»Æ¬
             -ÇøÓò»­µ¯´°
 439   1         OLED_DrawRectangle(win->x, win->y, win->x + win->with - 1, win->y + win->hight - 1, 1);      // »­´°¿Ú
 440   1         OLED_Draw_HLine(win->x, win->y + 9, win->x + win->with - 1, 1);                                                      // »­±êÌâÄ¿À¸
 441   1      //   OLED_Draw_RLine(win->x + 9, win->y, win->y + 9, 1);                                                                                // »­¹Ø±Õ´°ºÅ°´Å¥
 442   1      //   OLED_DrawLine(win->x, win->y, win->x + 9, win->y + 9, 1);
 443   1      //   OLED_DrawLine(win->x + 9, win->y, win->x, win->y + 9, 1);
 444   1         OLED_Draw_RLine(win->x + win->with - 10, win->y, win->y + 9, 1);                                                                             // »­¹Ø±Õ´°ºÅ°´Å¥
 445   1         OLED_DrawLine(win->x + win->with - 10, win->y, win->x + win->with - 1 , win->y + 9, 1);
 446   1         OLED_DrawLine(win->x + win->with - 1, win->y, win->x + win->with - 10, win->y + 9, 1);
 447   1         
 448   1      
 449   1         /* Ð´±êÌâ */
 450   1         if( win->title != 0 ) 
 451   1         {  str = win->title;
 452   2            bak = win->x + 2;
 453   2            bak1 = win->y + 1;                  //titleÎ»ÖÃ
 454   2            bak2 = win->x + win->with -1;
 455   2           
 456   2            while(1)                                          
 457   2            {  if( (bak+8) > bak2 ) break;                                                            // ÅÐ¶Ï±êÌâÊÇ·ñÒç³ö
 458   3               if(*str=='\0') break;                                                                          // ÅÐ¶Ï×Ö·û´®ÊÇ·ñ½áÊø
 459   3               
 460   3               OLED_ShowChar(bak, bak1, *str++,7,1);                                                  // ÏÔÊ¾±êÌâ
 461   3               bak += 6;
 462   3            }
 463   2         }
 464   1      
 465   1         /* Ð´ÄÚÈÝ */
 466   1         if( win->text != 0 ) 
 467   1         {  str = win->text;
 468   2            bak = win->x + 2;
 469   2            bak1 = win->y + 12;                 //textÎ»ÖÃ
 470   2            bak2 = win->x + win->with -1;
 471   2           
 472   2            while(1)                                          
 473   2            {  if( (bak+8) > bak2 ) break;                                                            // ÅÐ¶Ï±êÌâÊÇ·ñÒç³ö
 474   3               if(*str=='\0') break;                                                                          // ÅÐ¶Ï×Ö·û´®ÊÇ·ñ½áÊø
 475   3               
 476   3               OLED_ShowChar(bak, bak1, *str++,7,1);                                                  // ÏÔÊ¾±êÌâ
 477   3               bak += 6;
 478   3            }
 479   2         }
 480   1      
 481   1         /* Ð´×´Ì¬À¸ */
 482   1         if( win->state != 0 )
 483   1         {  if( win->hight < 25) return(0);                                                           // ÅÐ¶ÏÊÇ·ñ¿ÉÒÔ»­×´Ì¬À¸
 484   2            /* »­×´Ì¬À¸ */
 485   2            OLED_Draw_HLine(win->x, win->y + win->hight - 10, win->x + win->with - 1, 1);
 486   2            
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 9   

 487   2            str = win->state;
 488   2            bak = win->x + 3;
 489   2            bak1 = win->y + win->hight - 9;
 490   2            bak2 = win->x + win->with -1;
 491   2            
 492   2            while(1)                                          
 493   2            {  if( (bak+8) > bak2 ) break;                                                            // ÅÐ¶Ï±êÌâÊÇ·ñÒç³ö
 494   3               if(*str=='\0') break;                                                                          // ÅÐ¶Ï×Ö·û´®ÊÇ·ñ½áÊø
 495   3               
 496   3               OLED_ShowChar(bak, bak1, *str++,7,1);                                                  // ÏÔÊ¾±êÌâ
 497   3               bak += 6;
 498   3            }      
 499   2         }
 500   1         
 501   1         return(1);
 502   1      
 503   1      }
 504          /*******************************************************************************************
 505          º¯ÊýÃû: void OLED_Fill(u8 x1,u8 y1,u8 x2,u8 y2,u8 dot)
 506          ËµÃ÷: Ìî³äÖ¸¶¨ÇøÓòRAM
 507          ********************************************************************************************/
 508          void OLED_Fill(u8 x1,u8 y1,u8 x2,u8 y2,u8 dot)  
 509          {  
 510   1              u8 x,y;  
 511   1              for(x=x1;x<=x2;x++)
 512   1              {
 513   2                      for(y=y1;y<=y2;y++)OLED_DrawPoint(x,y,dot);
 514   2              }                                                                                                           
 515   1              OLED_Refresh_Gram();//¸üÐÂÏÔÊ¾
 516   1      }
 517          
 518          
 519          /*******************************************************************************************
 520          º¯ÊýÃû: void OLED_ShowChar(u8 x,u8 y,u8 chr,u8 size,u8 mode)
 521          ËµÃ÷: ÏÔÊ¾×Ö·û
 522          //ÔÚÖ¸¶¨Î»ÖÃÏÔÊ¾Ò»¸ö×Ö·û,°üÀ¨²¿·Ö×Ö·û
 523          //x:0~127
 524          //y:0~63
 525          //mode:0,·´°×ÏÔÊ¾;1,Õý³£ÏÔÊ¾                             
 526          //size:Ñ¡Ôñ×ÖÌå 16/12/7 
 527          ********************************************************************************************/
 528          void OLED_ShowChar(u8 x,u8 y,u8 chr,u8 size,u8 mode)
 529          {                           
 530   1              u8 temp,t,t1;
 531   1              u8 y0=y;
 532   1              chr=chr-' ';//µÃµ½Æ«ÒÆºóµÄÖµ                               
 533   1          for(t=0;t<size;t++)
 534   1          {   
 535   2                  if(size==7)temp=ByteMirro(F7x5[chr][t]); //µ÷ÓÃ0806×ÖÌå  ÒòÎª×Ö¿âÊÇ·´µÄ£¬ËùÒÔ¾µÏñ´¦ÀíÁË£¡
 536   2                      else if(size==12)temp=asc2_1206[chr][t];  //µ÷ÓÃ1206×ÖÌå
 537   2                      else temp=asc2_1608[chr][t];             //µ÷ÓÃ1608×ÖÌå                                   
 538   2              for(t1=0;t1<8;t1++)
 539   2                      {
 540   3                              if(temp&0x80)OLED_DrawPoint(x,y,mode);
 541   3                              else OLED_DrawPoint(x,y,!mode);
 542   3                              temp<<=1;
 543   3                              y++;
 544   3                              if((y-y0)==size)
 545   3                              {
 546   4                                      y=y0;
 547   4                                      x++;
 548   4                                      break;
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 10  

 549   4                              }
 550   3                      }        
 551   2          }          
 552   1      }
 553          //m^nº¯Êý
 554          u32 mypow(u8 m,u8 n)
 555          {
 556   1              u32 result=1;    
 557   1              while(n--)result*=m;    
 558   1              return result;
 559   1      }                                 
 560          
 561          /*******************************************************************************************
 562          º¯ÊýÃû: void OLED_ShowNum(u8 x,u8 y,u32 num,u8 len,u8 size)
 563          ËµÃ÷: ÏÔÊ¾Êý×Ö
 564          //x,y :Æðµã×ø±ê  
 565          //len :Êý×ÖµÄÎ»Êý
 566          //size:×ÖÌå´óÐ¡
 567          //mode:Ä£Ê½     0,Ìî³äÄ£Ê½;1,µþ¼ÓÄ£Ê½
 568          //num:ÊýÖµ(0~4294967295);
 569          ********************************************************************************************/                     
 570          void OLED_ShowNum(u8 x,u8 y,u32 num,u8 len,u8 size)
 571          {               
 572   1              u8 t,temp;
 573   1              u8 enshow=0;                                               
 574   1              for(t=0;t<len;t++)
 575   1              {
 576   2                      temp=(num/mypow(10,len-t-1))%10;
 577   2                      if(enshow==0&&t<(len-1))
 578   2                      {
 579   3                              if(temp==0)
 580   3                              {
 581   4                                      OLED_ShowChar(x+(size/2)*t,y,' ',size,1);
 582   4                                      continue;
 583   4                              }else enshow=1; 
 584   3                               
 585   3                      }
 586   2                      OLED_ShowChar(x+(size/2)*t,y,temp+'0',size,1); 
 587   2              }
 588   1      } 
 589          /*******************************************************************************************
 590          º¯ÊýÃû: void OLED_ShowString(u8 x,u8 y,const u8 *p,u8 size)
 591          ËµÃ÷: ÏÔÊ¾×Ö·û´®
 592          //ÏÔÊ¾×Ö·û´®
 593          //x,y:Æðµã×ø±ê  
 594          //*p:×Ö·û´®ÆðÊ¼µØÖ·
 595          ********************************************************************************************/
 596          void OLED_ShowString(u8 x,u8 y,const u8 *p,u8 size, u8 mode)
 597          {
 598   1                 
 599   1          while(*p!='\0')
 600   1          { 
 601   2                  if(size == 16)
 602   2                      {      
 603   3                      if(x>122){x=0;y+=16;}   //»»ÐÐ
 604   3                      if(y>32){y=x=0;OLED_Clear();} //»»Ò³
 605   3                      OLED_ShowChar(x,y,*p,16,mode);   
 606   3                      x+=8;
 607   3                      }
 608   2                      else if(size == 12)
 609   2                      {
 610   3                      if(x>122){x=0;y+=12;}   //»»ÐÐ
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 11  

 611   3                      if(y>32){y=x=0;OLED_Clear();} //»»Ò³
 612   3                      OLED_ShowChar(x,y,*p,12,mode);   
 613   3                      x+=6;           
 614   3                      }
 615   2                      else
 616   2                      {
 617   3                      if(x>122){x=0;y+=8;}    //»»ÐÐ
 618   3                      if(y>32){y=x=0;OLED_Clear();} //»»Ò³
 619   3                      OLED_ShowChar(x,y,*p,7,mode);    
 620   3                      x+=6;           
 621   3                      }
 622   2              p++;
 623   2          }  
 624   1      }
 625          
 626          /*******************************************************************************************
 627          º¯ÊýÃû: void OLED_ShowFont16(u8 x,u8 y,u8 fno,u8 mode)
 628          ËµÃ÷: ÏÔÊ¾ºº×Ö
 629          //ÏÔÊ¾ºº×Ö
 630          //ÔÚÖ¸¶¨Î»ÖÃÏÔÊ¾Ò»¸öºº×Ö
 631          //x:0~127
 632          //y:0~63
 633          //fno:ºº×Ö±àºÅ
 634          //mode:0,·´°×ÏÔÊ¾;1,Õý³£ÏÔÊ¾                             
 635          //16*16´óÐ¡µÄ×Ö·û
 636          ********************************************************************************************/
 637          void OLED_ShowFont16(u8 x,u8 y,u8 fno,u8 mode)
 638          {                           
 639   1              u8 temp,t,t1;
 640   1              u8 y0=y;                                   
 641   1          for(t=0;t<32;t++)
 642   1          {   
 643   2                      if(t<16)temp=Hzk[fno*2][t];                               
 644   2              else temp=Hzk[fno*2+1][t-16];   
 645   2                      for(t1=0;t1<8;t1++)
 646   2                      {
 647   3                              if(temp&0x80)OLED_DrawPoint(x,y,mode);
 648   3                              else OLED_DrawPoint(x,y,!mode);
 649   3                              temp<<=1;
 650   3                              y++;
 651   3                              if((y-y0)==16)
 652   3                              {
 653   4                                      y=y0;
 654   4                                      x++;
 655   4                                      break;
 656   4                              }
 657   3                      }        
 658   2          }          
 659   1      }
 660          /*******************************************************************************************
 661          º¯ÊýÃû: void OLED_DrawTriangle(u8 x1, u8 y1, u8 len,u8 t)
 662          ËµÃ÷: »­Èý½ÇÐÎ£¬ ÆðÊ¼Î»ÖÃ×ø±ê  
 663          ********************************************************************************************/
 664          void OLED_DrawTriangle(u8 x1, u8 y1, u8 len,u8 t)
 665          {
 666   1        OLED_DrawLine(x1,y1,x1-len,y1+len,t);
 667   1        OLED_DrawLine(x1,y1,x1+len,y1+len,t);
 668   1        OLED_DrawLine(x1+len,y1+len,x1-len,y1+len,t); //»­Èý½ÇÐÎ
 669   1      }
 670          /*******************************************************************************************
 671          º¯ÊýÃû: void OLED_DrawBar(u8 x1, u8 y1, u8 x2, u8 y2, u8 t)
 672          ËµÃ÷: »­½ø¶ÈÌõ£¬ ÆðÊ¼Î»ÖÃ×ø±ê  
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 12  

 673          ********************************************************************************************/
 674          void OLED_DrawSetBar(u8 x1, u8 y1, u8 x2, u8 y2, u8 num, u8 num1,u8 t)
 675          { 
 676   1        u8 i; 
 677   1        u8 xtmp;
 678   1        xtmp = (x2-x1)/num;
 679   1        OLED_Draw_RectangleFill(x1-3, y1-2, x2+4, y2+12, 0);                              
 680   1        OLED_DrawRectangle(x1, y1, x2, y2, t);
 681   1      
 682   1        OLED_DrawTriangle(x1+xtmp*num1, y2+1, 3,1);
 683   1        OLED_Draw_RectangleFill(x1+1, y1+1, x1+xtmp*num1, y2-1, t);
 684   1        OLED_ShowChar(x1+xtmp*num1-6,y2+6,Hex2Dat(((num1/10)&0x0f)),7,1);
 685   1        OLED_ShowChar(x1+xtmp*num1,y2+6,Hex2Dat(((num1%10)&0x0f)),7,1);
 686   1        /*
 687   1        switch(num)
 688   1        {
 689   1          case 0:
 690   1                 OLED_DrawTriangle(x1+1, y2+1, 3,1);
 691   1      
 692   1              break;
 693   1          case 1:
 694   1                 OLED_DrawTriangle(xtmp, y2+1, 3,1);
 695   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+xtmp, y2-1, t);
 696   1              break;
 697   1          case 2:
 698   1                 OLED_DrawTriangle(2*xtmp, y2+1, 3,1);
 699   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+2*xtmp, y2-1, t);
 700   1              break;
 701   1          case 3:
 702   1                 OLED_DrawTriangle(3*xtmp, y2+1, 3,1);
 703   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+3*xtmp, y2-1, t);
 704   1              break;
 705   1         case 4:
 706   1                 OLED_DrawTriangle(4*xtmp, y2+1, 3,1);
 707   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+4*xtmp, y2-1, t);
 708   1              break;
 709   1          case 5:
 710   1                 OLED_DrawTriangle(5*xtmp, y2+1, 3,1);
 711   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+5*xtmp, y2-1, t);
 712   1              break;
 713   1          case 6:
 714   1                 OLED_DrawTriangle(6*xtmp, y2+1, 3,1);
 715   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+6*xtmp, y2-1, t);
 716   1              break;
 717   1          case 7:
 718   1                 OLED_DrawTriangle(7*xtmp, y2+1, 3,1);
 719   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+7*xtmp, y2-1, t);
 720   1              break;
 721   1         case 8:
 722   1                 OLED_DrawTriangle(8*xtmp, y2+1, 3,1);
 723   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+8*xtmp, y2-1, t);
 724   1              break;
 725   1          case 9:
 726   1                 OLED_DrawTriangle(9*xtmp, y2+1, 3,1);
 727   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+9*xtmp, y2-1, t);
 728   1              break;
 729   1          case 10:
 730   1                 OLED_DrawTriangle(10*xtmp, y2+1, 3,1);
 731   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+10*xtmp, y2-1, t);
 732   1              break;
 733   1          case 11:
 734   1                 OLED_DrawTriangle(11*xtmp, y2+1, 3,1);
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 13  

 735   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+11*xtmp, y2-1, t);
 736   1              break;
 737   1         case 12:
 738   1                 OLED_DrawTriangle(12*xtmp, y2+1, 3,1);
 739   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+12*xtmp, y2-1, t);
 740   1              break;
 741   1          case 13:
 742   1                 OLED_DrawTriangle(13*xtmp, y2+1, 3,1);
 743   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+13*xtmp, y2-1, t);
 744   1              break;
 745   1          case 14:
 746   1                 OLED_DrawTriangle(14*xtmp, y2+1, 3,1);
 747   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+14*xtmp, y2-1, t);
 748   1              break;
 749   1          case 15:
 750   1                 OLED_DrawTriangle(15*xtmp, y2+1, 3,1);
 751   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+15*xtmp, y2-1, t);
 752   1              break;
 753   1         case 16:
 754   1                 OLED_DrawTriangle(16*xtmp, y2+1, 3,1);
 755   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+16*xtmp, y2-1, t);
 756   1              break;
 757   1          case 17:
 758   1                 OLED_DrawTriangle(17*xtmp, y2+1, 3,1);
 759   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+17*xtmp, y2-1, t);
 760   1              break;
 761   1          case 18:
 762   1                 OLED_DrawTriangle(18*xtmp, y2+1, 3,1);
 763   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+18*xtmp, y2-1, t);
 764   1              break;
 765   1         case 19:
 766   1                 OLED_DrawTriangle(19*xtmp, y2+1, 3,1);
 767   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+19*xtmp, y2-1, t);
 768   1              break;
 769   1          case 20:
 770   1                 OLED_DrawTriangle(20*xtmp, y2+1, 3,1);
 771   1                 OLED_Draw_RectangleFill(x1+1, y1+1, x1+20*xtmp, y2-1, t);
 772   1              break;
 773   1        }
 774   1        */
 775   1        OLED_Refresh_Gram(); 
 776   1           
 777   1      }
*** WARNING C280 IN LINE 676 OF OLED\OLED.C: 'i': unreferenced local variable
 778          /*******************************************************************************************
 779          º¯ÊýÃû: void OLED_DrawBar(u8 x1, u8 y1, u8 x2, u8 y2, u8 t)
 780          ËµÃ÷: »­½ø¶ÈÌõ£¬ ÆðÊ¼Î»ÖÃ×ø±ê  
 781          ********************************************************************************************/
 782          void OLED_DrawBar(u8 x1, u8 y1, u8 x2, u8 y2, u8 t)
 783          { 
 784   1        u8 i;                             
 785   1        OLED_DrawRectangle(x1, y1, x2, y2, t);
 786   1        for(i=0;i<x2-x1;i++)
 787   1        {
 788   2          OLED_Draw_RectangleFill(x1+1, y1+1, x1+i, y2-1, t); 
 789   2              OLED_Refresh_Gram();
 790   2              delay_10ms();
 791   2              delay_10ms();
 792   2        }      
 793   1      }
 794          /*******************************************************************************************
 795          º¯ÊýÃû: void OLED_DrawBMP(u8 x,u8 y)
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 14  

 796          ËµÃ÷: »­Î»Í¼ ÆðÊ¼Î»ÖÃ×ø±ê x,y
 797          ********************************************************************************************/
 798          void OLED_DrawBMP(u8 x,u8 y,u8 mode)
 799          {                           
 800   1              u16 temp,t,t1;
 801   1              u16 y0=y;                                                                          
 802   1          for(t=0;t<512;t++)
 803   1          {  
 804   2                  temp = logo[t];                               
 805   2              for(t1=0;t1<8;t1++)
 806   2                      {
 807   3                              if(temp&0x80)OLED_DrawPoint(x,y,mode); 
 808   3                              else OLED_DrawPoint(x,y,!mode);            
 809   3                              temp<<=1;
 810   3                              y++;
 811   3                              if((y-y0)==32)
 812   3                              {
 813   4                                      y=y0;
 814   4                                      x++;
 815   4                                      break;
 816   4                              }
 817   3                      }        
 818   2          }          
 819   1      }
 820          
 821          /*******************************************************************************************
 822          void OLED_DrawICON(u8 x,u8 y,u16 size ,u8 mode)
 823          ËµÃ÷: »­Î»Í¼ ÆðÊ¼Î»ÖÃ×ø±ê x,y
 824          ********************************************************************************************/
 825          void OLED_DrawICON(u8 x,u8 y,u8 mode,void *icon)
 826          {                           
 827   1              u16 temp,t,t1;
 828   1              u16 y0=y;                                                                          
 829   1          for(t=0;t<128;t++)
 830   1          {  
 831   2                  temp = *(u8*)icon ; 
 832   2                      ((u8*)icon)++;                            
 833   2              for(t1=0;t1<8;t1++)
 834   2                      {
 835   3                              if(temp&0x80)OLED_DrawPoint(x,y,mode); 
 836   3                              else OLED_DrawPoint(x,y,!mode);            
 837   3                              temp<<=1;
 838   3                              y++;
 839   3                              if((y-y0)==32)
 840   3                              {
 841   4                                      y=y0;
 842   4                                      x++;
 843   4                                      break;
 844   4                              }
 845   3                      }        
 846   2          }          
 847   1      }
 848          
 849          void Disp_Menu_Main(u8 num)
 850          {
 851   1          OLED_ShowChar(0,11,'<',12,1);
 852   1          OLED_ShowChar(120,11,'>',12,1);
 853   1              if(num == 0)
 854   1              {
 855   2                  OLED_DrawICON(10,0,0,set_ico);
 856   2                  OLED_DrawICON(48,0,1,cut_ico);
 857   2                  OLED_DrawICON(86,0,1,test_ico);
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 15  

 858   2              } 
 859   1              else if(num == 1)
 860   1              {
 861   2                  OLED_DrawICON(10,0,1,set_ico);
 862   2                  OLED_DrawICON(48,0,0,cut_ico);
 863   2                  OLED_DrawICON(86,0,1,test_ico);
 864   2              }
 865   1              else
 866   1              {
 867   2                  OLED_DrawICON(10,0,1,set_ico);
 868   2                  OLED_DrawICON(48,0,1,cut_ico);
 869   2                  OLED_DrawICON(86,0,0,test_ico);
 870   2              }
 871   1      //      OLED_Refresh_Gram();
 872   1      }
 873          void Disp_Menu_1(u8 num)
 874          {
 875   1      //    OLED_ShowChar(0,11,'<',12,1);
 876   1      //    OLED_ShowChar(120,11,'>',12,1);
 877   1              if(num == 0)
 878   1              {
 879   2                  OLED_ShowString(0,0,"1.VT62538-B1",12,0);
 880   2                  OLED_ShowString(0,15,"2.VT62538-B2",12,1);
 881   2                  OLED_ShowString(78,0,"3.COB",12,1);
 882   2                  OLED_ShowString(78,15,"4.RETURN",12,1);
 883   2              } 
 884   1              else if(num == 1)
 885   1              {
 886   2                  OLED_ShowString(0,0,"1.VT62538-B1",12,1);
 887   2                  OLED_ShowString(0,15,"2.VT62538-B2",12,0);
 888   2                  OLED_ShowString(78,0,"3.COB",12,1);
 889   2                  OLED_ShowString(78,15,"4.RETURN",12,1);
 890   2              }
 891   1              else if(num == 2)
 892   1              {
 893   2                  OLED_ShowString(0,0,"1.VT62538-B1",12,1);
 894   2                  OLED_ShowString(0,15,"2.VT62538-B2",12,1);
 895   2                  OLED_ShowString(78,0,"3.COB",12,0);
 896   2                  OLED_ShowString(78,15,"4.RETURN",12,1);
 897   2              }
 898   1              else
 899   1              {
 900   2                  OLED_ShowString(0,0,"1.VT62538-B1",12,1);
 901   2                  OLED_ShowString(0,15,"2.VT62538-B2",12,1);
 902   2                  OLED_ShowString(78,0,"3.COB",12,1);
 903   2                  OLED_ShowString(78,15,"4.RETURN",12,0);
 904   2              }
 905   1      }
 906          
 907          void Disp_Menu_0(u8 num)
 908          {
 909   1              if(num == 0)
 910   1              {
 911   2                  OLED_ShowString(0,0,"1.SET LINE",12,0);
 912   2                  OLED_ShowString(0,15,"2.SET SENS",12,1);
 913   2                  OLED_ShowString(78,0,"3.ERASE",12,1);
 914   2                  OLED_ShowString(78,15,"4.RETURN",12,1);
 915   2              } 
 916   1              else if(num == 1)
 917   1              {
 918   2                  OLED_ShowString(0,0,"1.SET LINE",12,1);
 919   2                  OLED_ShowString(0,15,"2.SET SENS",12,0);
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 16  

 920   2                  OLED_ShowString(78,0,"3.ERASE",12,1);
 921   2                  OLED_ShowString(78,15,"4.RETURN",12,1);
 922   2              }
 923   1              else if(num == 2)
 924   1              {
 925   2                  OLED_ShowString(0,0,"1.SET LINE",12,1);
 926   2                  OLED_ShowString(0,15,"2.SET SENS",12,1);
 927   2                  OLED_ShowString(78,0,"3.ERASE",12,0);
 928   2                  OLED_ShowString(78,15,"4.RETURN",12,1);
 929   2              }
 930   1              else
 931   1              {
 932   2                  OLED_ShowString(0,0,"1.SET LINE",12,1);
 933   2                  OLED_ShowString(0,15,"2.SET SENS",12,1);
 934   2                  OLED_ShowString(78,0,"3.ERASE",12,1);
 935   2                  OLED_ShowString(78,15,"4.RETURN",12,0);
 936   2              } 
 937   1      }
 938          
 939          /*******************************************************************************************
 940          º¯ÊýÃû: void OLED_ShowAdd(u8 x,u8 y,u32 Add1,u32 Add2)
 941          ËµÃ÷: »­Î»Í¼ ÆðÊ¼Î»ÖÃ×ø±ê x,y
 942          ********************************************************************************************/
 943          void OLED_ShowAdd(u8 x,u8 y,u32 Add1,u32 Add2)
 944          {                           
 945   1        OLED_ShowString(x+4,y,"SADD:",7,1);    //µÚÒ»ÐÐ×Ö·û
 946   1        OLED_ShowString(x+4,y+16,"RADD:",7,1);   //µÚÈýÐÐ×Ö·û 
 947   1        OLED_DrawLine(38,0,38,31,1); 
 948   1        OLED_DrawLine(38,0,40,0,1); 
 949   1        OLED_DrawLine(38,15,40,15,1);
 950   1        OLED_DrawLine(38,31,40,31,1);                  //»­·Ö¸îÏß
 951   1        x = x+36;
 952   1        OLED_ShowChar(x+6,y,((Add1>>23)&0x01)+'0',7,1);
 953   1        OLED_ShowChar(x+6*2,y,((Add1>>22)&0x01)+'0',7,1);
 954   1        OLED_ShowChar(x+6*3,y,((Add1>>21)&0x01)+'0',7,1);
 955   1        OLED_ShowChar(x+6*4,y,((Add1>>20)&0x01)+'0',7,1);
 956   1        OLED_ShowChar(x+6*5,y,'-',7,1);
 957   1        OLED_ShowChar(x+6*6,y,((Add1>>19)&0x01)+'0',7,1);
 958   1        OLED_ShowChar(x+6*7,y,((Add1>>18)&0x01)+'0',7,1);
 959   1        OLED_ShowChar(x+6*8,y,((Add1>>17)&0x01)+'0',7,1);
 960   1        OLED_ShowChar(x+6*9,y,((Add1>>16)&0x01)+'0',7,1);
 961   1        OLED_ShowChar(x+6*10,y,'-',7,1);
 962   1        OLED_ShowChar(x+6*11,y,((Add1>>15)&0x01)+'0',7,1);
 963   1        OLED_ShowChar(x+6*12,y,((Add1>>14)&0x01)+'0',7,1);
 964   1        OLED_ShowChar(x+6*13,y,((Add1>>13)&0x01)+'0',7,1);
 965   1        OLED_ShowChar(x+6*14,y,((Add1>>12)&0x01)+'0',7,1);
 966   1       // OLED_ShowChar(x+6*15,y,'-',7,1);
 967   1        OLED_ShowChar(x+6,y+8,((Add1>>11)&0x01)+'0',7,1);
 968   1        OLED_ShowChar(x+6*2,y+8,((Add1>>10)&0x01)+'0',7,1);
 969   1        OLED_ShowChar(x+6*3,y+8,((Add1>>9)&0x01)+'0',7,1);
 970   1        OLED_ShowChar(x+6*4,y+8,((Add1>>8)&0x01)+'0',7,1);
 971   1        OLED_ShowChar(x+6*5,y+8,'-',7,1);
 972   1        OLED_ShowChar(x+6*6,y+8,((Add1>>7)&0x01)+'0',7,1);
 973   1        OLED_ShowChar(x+6*7,y+8,((Add1>>6)&0x01)+'0',7,1);
 974   1        OLED_ShowChar(x+6*8,y+8,((Add1>>5)&0x01)+'0',7,1);
 975   1        OLED_ShowChar(x+6*9,y+8,((Add1>>4)&0x01)+'0',7,1);
 976   1        OLED_ShowChar(x+6*10,y+8,'-',7,1);
 977   1        OLED_ShowChar(x+6*11,y+8,((Add1>>3)&0x01)+'0',7,1);
 978   1        OLED_ShowChar(x+6*12,y+8,((Add1>>2)&0x01)+'0',7,1);
 979   1        OLED_ShowChar(x+6*13,y+8,((Add1>>1)&0x01)+'0',7,1);
 980   1        OLED_ShowChar(x+6*14,y+8,((Add1)&0x01)+'0',7,1);
 981   1      
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 17  

 982   1        OLED_ShowChar(x+6,y+16,((Add2>>23)&0x01)+'0',7,1);
 983   1        OLED_ShowChar(x+6*2,y+16,((Add2>>22)&0x01)+'0',7,1);
 984   1        OLED_ShowChar(x+6*3,y+16,((Add2>>21)&0x01)+'0',7,1);
 985   1        OLED_ShowChar(x+6*4,y+16,((Add2>>20)&0x01)+'0',7,1);
 986   1        OLED_ShowChar(x+6*5,y+16,'-',7,1);
 987   1        OLED_ShowChar(x+6*6,y+16,((Add2>>19)&0x01)+'0',7,1);
 988   1        OLED_ShowChar(x+6*7,y+16,((Add2>>18)&0x01)+'0',7,1);
 989   1        OLED_ShowChar(x+6*8,y+16,((Add2>>17)&0x01)+'0',7,1);
 990   1        OLED_ShowChar(x+6*9,y+16,((Add2>>16)&0x01)+'0',7,1);
 991   1        OLED_ShowChar(x+6*10,y+16,'-',7,1);
 992   1        OLED_ShowChar(x+6*11,y+16,((Add2>>15)&0x01)+'0',7,1);
 993   1        OLED_ShowChar(x+6*12,y+16,((Add2>>14)&0x01)+'0',7,1);
 994   1        OLED_ShowChar(x+6*13,y+16,((Add2>>13)&0x01)+'0',7,1);
 995   1        OLED_ShowChar(x+6*14,y+16,((Add2>>12)&0x01)+'0',7,1);
 996   1      //  OLED_ShowChar(x+6*15,y+16,'-',7,1);
 997   1      
 998   1        OLED_ShowChar(x+6,y+24,((Add2>>11)&0x01)+'0',7,1);
 999   1        OLED_ShowChar(x+6*2,y+24,((Add2>>10)&0x01)+'0',7,1);
1000   1        OLED_ShowChar(x+6*3,y+24,((Add2>>9)&0x01)+'0',7,1);
1001   1        OLED_ShowChar(x+6*4,y+24,((Add2>>8)&0x01)+'0',7,1);
1002   1        OLED_ShowChar(x+6*5,y+24,'-',7,1);
1003   1        OLED_ShowChar(x+6*6,y+24,((Add2>>7)&0x01)+'0',7,1);
1004   1        OLED_ShowChar(x+6*7,y+24,((Add2>>6)&0x01)+'0',7,1);
1005   1        OLED_ShowChar(x+6*8,y+24,((Add2>>5)&0x01)+'0',7,1);
1006   1        OLED_ShowChar(x+6*9,y+24,((Add2>>4)&0x01)+'0',7,1);
1007   1        OLED_ShowChar(x+6*10,y+24,'-',7,1);
1008   1        OLED_ShowChar(x+6*11,y+24,((Add2>>3)&0x01)+'0',7,1);
1009   1        OLED_ShowChar(x+6*12,y+24,((Add2>>2)&0x01)+'0',7,1);
1010   1        OLED_ShowChar(x+6*13,y+24,((Add2>>1)&0x01)+'0',7,1);
1011   1        OLED_ShowChar(x+6*14,y+24,((Add2)&0x01)+'0',7,1);    
1012   1      }
1013          /*******************************************************************************************
1014          º¯ÊýÃû: void OLED_Init(void)
1015          ËµÃ÷: OLEDÆÁ³õÊ¼»¯
1016          ********************************************************************************************/                               
1017          void OLED_Init(void)
1018          {
1019   1          OLED_RST_Set();
1020   1              delay_ms(100);
1021   1              OLED_RST_Clr();
1022   1              delay_ms(100);
1023   1              OLED_RST_Set(); 
1024   1      
1025   1              OLED_WR_Byte(0xFD,OLED_CMD);//ÄÚ²¿µ¥Æ¬»úÐ´±£»¤
1026   1              OLED_WR_Byte(0x12,OLED_CMD);//Ä¬ÈÏ¹Ø±ÕÄÚ²¿±£»¤£¬ÔÊÐí½ÓÊÕËùÓÐÖ¸Áî£¬Èç¿ªÆô±£»¤ÔòÖ»½ÓÊÜFDÖ¸Áî £¿Ä¬ÈÏÎª0£¬Îª1
             -Ôò±£»¤ bit 0 0 0 1 0 £¿1 0
1027   1                      
1028   1              OLED_WR_Byte(0xAE,OLED_CMD);//¹Ø±ÕÏÔÊ¾
1029   1      
1030   1              OLED_WR_Byte(0x20,OLED_CMD);
1031   1              OLED_WR_Byte(0x02,OLED_CMD);//page mode
1032   1      
1033   1              OLED_WR_Byte(0xB4,OLED_CMD);
1034   1      
1035   1              OLED_WR_Byte(0x00,OLED_CMD);//
1036   1              OLED_WR_Byte(0x10,OLED_CMD);//
1037   1      
1038   1      //      OLED_WR_Byte(0x40,OLED_CMD);//ÉèÖÃÏÔÊ¾¿ªÊ¼ÐÐ40H+0~63
1039   1              OLED_WR_Byte(0x60,OLED_CMD);//ÉèÖÃÏÔÊ¾¿ªÊ¼ÐÐ40H+0~63
1040   1      
1041   1              OLED_WR_Byte(0xD5,OLED_CMD);//ÉèÖÃÊ±ÖÓ·ÖÆµÒò×Ó£¬Õñµ´ÆµÂÊ
1042   1              OLED_WR_Byte(0xf0,OLED_CMD);//[3:0],·ÖÆµÒò×Ó;[7:4],Õðµ´ÆµÂÊ     Ä¬ÈÏ0111 0000   PS´ó²¿·ÖÇý¶¯¶¼Ñ¡ÔñÊÇ0x80
C51 COMPILER V9.00   OLED                                                                  04/27/2015 19:27:07 PAGE 18  

1043   1      
1044   1              OLED_WR_Byte(0xA8,OLED_CMD);//ÉèÖÃ¶àÖØÍ¨µÀ
1045   1              OLED_WR_Byte(0x1F,OLED_CMD);//Ä¬ÈÏ0X3F
1046   1      
1047   1              OLED_WR_Byte(0xD3,OLED_CMD);//ÉèÖÃÏÔÊ¾Æ«ÒÆ
1048   1              OLED_WR_Byte(0x00,OLED_CMD);//Ä¬ÈÏ²»Æ«ÒÆ[5:0]
1049   1      
1050   1      
1051   1      
1052   1              OLED_WR_Byte(0xA1,OLED_CMD);//¶ÎÖØ¶¨ÒåÉèÖÃ,bit0:   0,0->0;  1,0->127
1053   1      
1054   1      //      OLED_WR_Byte(0xA0,OLED_CMD);//¶ÎÖØ¶¨ÒåÉèÖÃ,bit0:   0,0->0;  1,0->127
1055   1      
1056   1      //      OLED_WR_Byte(0xC8,OLED_CMD);//ÉèÖÃCOMÉ¨Ãè·½Ïò;bit3: 0,ÆÕÍ¨Ä£Ê½;1,ÖØ¶¨ÒåÄ£Ê½ COM[N-1]->COM0
1057   1      
1058   1          OLED_WR_Byte(0xC0,OLED_CMD);//ÉèÖÃCOMÉ¨Ãè·½Ïò;bit3: 0,ÆÕÍ¨Ä£Ê½;1,ÖØ¶¨ÒåÄ£Ê½ COM[N-1]->COM0
1059   1      
1060   1              OLED_WR_Byte(0xD8,OLED_CMD);//
1061   1              OLED_WR_Byte(0x05,OLED_CMD);
1062   1      
1063   1              OLED_WR_Byte(0xDA,OLED_CMD);//ÉèÖÃCOMÓ²¼þÒý½ÅÅäÖÃ
1064   1              OLED_WR_Byte(0x12,OLED_CMD);//Ä¬ÈÏ[5:4]ÅäÖÃ
1065   1      
1066   1      //      OLED_WR_Byte(0x00,OLED_CMD);// £¿£¿£¿£¿Ã»É¶ÓÃ°É........
1067   1      
1068   1              OLED_WR_Byte(0xD9,OLED_CMD);//ÉèÖÃÔ¤³äµçÖÜÆÚ
1069   1              OLED_WR_Byte(0xF1,OLED_CMD);//Ä¬ÈÏ[3:0],PHASE 1;[7:4],PHASE 2;
1070   1      
1071   1              OLED_WR_Byte(0x81,OLED_CMD);//¶Ô±È¶ÈÉèÖÃ
1072   1              OLED_WR_Byte(0xBF,OLED_CMD);//1~255;Ä¬ÈÏ0X7F (ÁÁ¶ÈÉèÖÃ,Ô½´óÔ½ÁÁ)
1073   1      
1074   1      //      OLED_WR_Byte(0xD9,OLED_CMD);//-Set Page Addressing Mode (0x00/0x01/0x02)
1075   1      //      OLED_WR_Byte(0x25,OLED_CMD);//
1076   1      
1077   1              OLED_WR_Byte(0xDB,OLED_CMD);//ÉèÖÃVCOMH µçÑ¹±¶ÂÊ
1078   1              OLED_WR_Byte(0x34,OLED_CMD);//[5:2] 0000,0.64*vcc;1101,0.78*vcc;1111,0.84*vcc;
1079   1      
1080   1              OLED_WR_Byte(0xA4,OLED_CMD);//È«¾ÖÏÔÊ¾¿ªÆô;bit0:1,¿ªÆô;0,¹Ø±Õ;(°×ÆÁ/ºÚÆÁ) A4/A5
1081   1              OLED_WR_Byte(0xA6,OLED_CMD);//ÉèÖÃÏÔÊ¾·½Ê½;bit0:1,·´ÏàÏÔÊ¾;0,Õý³£ÏÔÊ¾     A6/A7
1082   1              OLED_WR_Byte(0xAF,OLED_CMD);//¿ªÆôÏÔÊ¾                                                            AE/AF
1083   1      
1084   1              OLED_Clear();
1085   1              OLED_Set_Pos(0,0);                      
1086   1      }  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   8690    ----
   CONSTANT SIZE    =   4881    ----
   XDATA SIZE       =   1024     160
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
